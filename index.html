<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flower Journey Map</title>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
/>
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
/>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: Arial, sans-serif;
    display: flex; flex-direction: column;
  }
  #filterBar {
    background: #4CAF50;
    padding: 10px 15px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px 20px;
    align-items: center;
    justify-content: center;
  }
  #filterBar > div {
    display: flex;
    flex-direction: column;
    min-width: 120px;
    color: white;
    font-weight: 600;
  }
  label {
    margin-bottom: 3px;
    font-size: 14px;
  }
  select {
    padding: 5px 8px;
    border-radius: 5px;
    border: none;
    font-size: 14px;
  }
  button {
    background: white;
    color: #4CAF50;
    border: none;
    font-weight: 700;
    border-radius: 6px;
    padding: 7px 16px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #e6e6e6;
  }
  #map {
    flex: 1;
  }
  @media (max-width: 600px) {
    #filterBar {
      flex-direction: column;
      align-items: stretch;
    }
    #filterBar > div {
      min-width: auto;
      width: 100%;
    }
    button {
      width: 100%;
    }
  }
</style>
</head>
<body>

<div id="filterBar">
  <div>
    <label for="placeSelect">Place</label>
    <select id="placeSelect">
      <option value="">-- All Places --</option>
    </select>
  </div>
  <div>
    <label for="nameSelect">Name</label>
    <select id="nameSelect">
      <option value="">-- All Names --</option>
    </select>
  </div>
  <div>
    <label for="colorSelect">Color</label>
    <select id="colorSelect">
      <option value="">-- All Colors --</option>
    </select>
  </div>
  <div>
    <label for="radiusSelect">Radius (m)</label>
    <select id="radiusSelect">
      <option value="1000">1000</option>
      <option value="3000">3000</option>
      <option value="5000" selected>5000</option>
      <option value="10000">10000</option>
    </select>
  </div>
  <div>
    <button id="setAreaPointBtn" title="Click map to set area center">Set Area Center</button>
  </div>
  <div>
    <button id="findInAreaBtn" title="Filter markers in area">Find in Area</button>
  </div>
  <div>
    <button id="resetBtn" title="Reset filters">Reset Filters</button>
  </div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>
  const flowerData = [
    { place: "Rome", name: "Rose", color: "Red", lat: 41.9028, lng: 12.4964 },
    { place: "Rome", name: "Lily", color: "White", lat: 41.905, lng: 12.49 },
    { place: "Florence", name: "Sunflower", color: "Yellow", lat: 43.7696, lng: 11.2558 },
    { place: "Milan", name: "Tulip", color: "Pink", lat: 45.4642, lng: 9.19 },
    { place: "Naples", name: "Orchid", color: "Purple", lat: 40.8518, lng: 14.2681 },
  ];

  const map = L.map("map").setView([41.9, 12.5], 6);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 18,
  }).addTo(map);

  const markerClusterGroup = L.markerClusterGroup();
  map.addLayer(markerClusterGroup);

  const markers = [];
  let areaCenterMarker = null;
  let areaCircle = null;

  const placeSelect = document.getElementById("placeSelect");
  const nameSelect = document.getElementById("nameSelect");
  const colorSelect = document.getElementById("colorSelect");
  const radiusSelect = document.getElementById("radiusSelect");
  const setAreaPointBtn = document.getElementById("setAreaPointBtn");
  const findInAreaBtn = document.getElementById("findInAreaBtn");
  const resetBtn = document.getElementById("resetBtn");

  function populateDropdowns() {
    const places = [...new Set(flowerData.map(f => f.place))].sort();
    const names = [...new Set(flowerData.map(f => f.name))].sort();
    const colors = [...new Set(flowerData.map(f => f.color))].sort();

    places.forEach(p => {
      const option = document.createElement("option");
      option.value = p;
      option.textContent = p;
      placeSelect.appendChild(option);
    });

    names.forEach(n => {
      const option = document.createElement("option");
      option.value = n;
      option.textContent = n;
      nameSelect.appendChild(option);
    });

    colors.forEach(c => {
      const option = document.createElement("option");
      option.value = c;
      option.textContent = c;
      colorSelect.appendChild(option);
    });
  }

  function createMarkers() {
    flowerData.forEach(f => {
      const marker = L.marker([f.lat, f.lng], {title: `${f.name} (${f.color}) in ${f.place}`})
        .bindPopup(`<b>${f.name}</b><br/>Color: ${f.color}<br/>Place: ${f.place}`);
      marker.data = f;
      markers.push(marker);
      markerClusterGroup.addLayer(marker);
    });
  }

  function filterMarkers() {
    const placeVal = placeSelect.value;
    const nameVal = nameSelect.value;
    const colorVal = colorSelect.value;
    const radius = parseInt(radiusSelect.value, 10);

    markerClusterGroup.clearLayers();

    markers.forEach(marker => {
      const f = marker.data;

      if (
        (placeVal && f.place !== placeVal) ||
        (nameVal && f.name !== nameVal) ||
        (colorVal && f.color !== colorVal)
      ) {
        return;
      }

      if (areaCenterMarker && areaCircle) {
        const dist = marker.getLatLng().distanceTo(areaCenterMarker.getLatLng());
        if (dist > radius) return;
      }

      markerClusterGroup.addLayer(marker);
    });
  }

  [placeSelect, nameSelect, colorSelect].forEach(sel =>
    sel.addEventListener("change", filterMarkers)
  );

  radiusSelect.addEventListener("change", () => {
    if (areaCircle && areaCenterMarker) {
      const radius = parseInt(radiusSelect.value, 10);
      areaCircle.setRadius(radius);
      filterMarkers();
    }
  });

  setAreaPointBtn.addEventListener("click", () => {
    alert("Click on the map to set the center point for the area filter");
    map.once("click", e => {
      if (areaCenterMarker) map.removeLayer(areaCenterMarker);
      if (areaCircle) map.removeLayer(areaCircle);

      areaCenterMarker = L.marker(e.latlng, {title: "Area Center"}).addTo(map);

      const radius = parseInt(radiusSelect.value, 10);
      areaCircle = L.circle(e.latlng, {
        radius,
        color: "blue",
        fillColor: "#3399ff",
        fillOpacity: 0.25,
      }).addTo(map);

      filterMarkers();
      map.setView(e.latlng, 10);
    });
  });

  findInAreaBtn.addEventListener("click", () => {
    if (!areaCenterMarker) {
      alert("Please set the area center first");
      return;
    }
    const radius = parseInt(radiusSelect.value, 10);
    if (areaCircle) areaCircle.setRadius(radius);
    filterMarkers();
  });

  resetBtn.addEventListener("click", () => {
    placeSelect.value = "";
    nameSelect.value = "";
    colorSelect.value = "";
    radiusSelect.value = "5000";

    if (areaCenterMarker) {
      map.removeLayer(areaCenterMarker);
      areaCenterMarker = null;
    }
    if (areaCircle) {
      map.removeLayer(areaCircle);
      areaCircle = null;
    }

    filterMarkers();
  });

  populateDropdowns();
  createMarkers();
  filterMarkers();
</script>

</body>
</html>

